<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Request Fuel Quota</title>
    <link rel="stylesheet" href="RequestQuota.css">
    <script src="HistoryManager.js" defer></script>
</head>
<body>
    <header>
        <h2 class="logo">hey</h2>
        <nav class="navigation">
            <a href="index.html">Home</a>
            <a href="Profile.html">Profile</a>
            <a href="#">Services</a>
            <a href="#">Quaso</a>
        </nav>
    </header>
    <div class="requestWrapper">
        <h2>Request Fuel Quota</h2>
        <form id="fuelQuotaForm">
            <label for="gallonsRequested">How many Gallons do you need:</label>
            <input type="number" id="gallonsRequested" name="gallonsRequested" required><br><br>

            <label for="deliveryState">Delivery State:</label>
            <select id="deliveryState" name="deliveryState" required>
                <option value="">Select State</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
            </select><br><br>

            <label for="fuelType">Fuel Type:</label>
            <select id="fuelType" name="fuelType" required>
                <option value="1.50">Regular - $1.50/gallon</option>
                <option value="2.50">Diesel - $2.50/gallon</option>
                <option value="3.50">Premium - $3.50/gallon</option>
            </select><br><br>

            <label>Total Amount Due: </label>
            <span id="totalAmountDue">$0.00</span><br><br>

            <label for="deliveryAddress">Delivery Address:</label>
            <input type="text" id="deliveryAddress" name="deliveryAddress" required><br><br>

            <label for="deliveryDate">Request Delivery Date:</label>
            <input type="date" id="deliveryDate" name="deliveryDate" required><br><br>

            <button type="submit" id="completeInfoBtn">Complete Info</button>
        </form>
        <div id="postSubmissionOptions">
            <button onclick="window.location.href='Profile.html'" class="btn">View Profile</button>
            <button onclick="window.location.href='ViewFuelHistory.html'" class="btn">View Fuel History</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('fuelQuotaForm');
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                submitFuelRequest();
            });

            function submitFuelRequest() {
                const gallonsRequested = parseInt(document.getElementById('gallonsRequested').value);
                const deliveryState = document.getElementById('deliveryState').value;
                const fuelType = parseFloat(document.getElementById('fuelType').value);
                const deliveryAddress = document.getElementById('deliveryAddress').value;
                const deliveryDate = document.getElementById('deliveryDate').value;

                const totalAmountDue = calculateTotalAmount(gallonsRequested, fuelType, deliveryState);

                const fuelRequestData = {
                    gallonsRequested,
                    deliveryState,
                    deliveryAddress,
                    deliveryDate,
                    fuelType: document.getElementById('fuelType').options[document.getElementById('fuelType').selectedIndex].text,
                    pricePerGallon: (fuelType + calculateMargin(fuelType, deliveryState, gallonsRequested)).toFixed(2),
                    totalAmountDue
                };

                HistoryManager.addEntry(fuelRequestData);
                document.getElementById('totalAmountDue').textContent = `$${totalAmountDue.toFixed(2)}`;
                document.getElementById('postSubmissionOptions').style.display = 'block';
                alert('Fuel request submitted successfully!');
            }

            function calculateTotalAmount(gallons, basePrice, state) {
                const margin = calculateMargin(basePrice, state, gallons);
                return gallons * (basePrice + margin);
            }

            function calculateMargin(pricePerGallon, deliveryState, gallonsRequested) {
                const locationFactor = deliveryState === 'TX' ? 0.02 : 0.04;
                const rateHistoryFactor = 0.01; // Simulating history check
                const gallonsRequestedFactor = gallonsRequested > 1000 ? 0.02 : 0.03;
                const companyProfitFactor = 0.10;
                return pricePerGallon * (locationFactor - rateHistoryFactor + gallonsRequestedFactor + companyProfitFactor);
            }

            ['input', 'change'].forEach(event => {
                document.getElementById('gallonsRequested').addEventListener(event, updateTotalAmountDue);
                document.getElementById('fuelType').addEventListener(event, updateTotalAmountDue);
                document.getElementById('deliveryState').addEventListener(event, updateTotalAmountDue);
            });

            function updateTotalAmountDue() {
                const gallons = parseInt(document.getElementById('gallonsRequested').value || 0);
                const basePrice = parseFloat(document.getElementById('fuelType').value);
                const state = document.getElementById('deliveryState').value;

                const total = calculateTotalAmount(gallons, basePrice, state);
                document.getElementById('totalAmountDue').textContent = `$${total.toFixed(2)}`;
            }
        });
    </script>
</body>
</html>
